define(["jquery","core/ajax"],function(a,b){var c={initialise:function(b,d){var e=".studentquiz_behaviour > .comments .comment_error",f=a(".studentquiz_behaviour .rate .rating .rateable");f.off("click").on("click",function(a){a.preventDefault(),c.addRating(this)}),f.on("keypress",function(a){13!==a.keyCode&&32!==a.keyCode||(a.preventDefault(),c.addRating(this))}),a('input[name="next"], input[name="previous"], input[name="finish"]').off("click").on("click",function(){var c=a(this),f=!a('.im-controls input[type="submit"]').length||a('.im-controls input[type="submit"]').filter(function(){return this.name.match(/^q.+-submit$/)}).is(":disabled");if(f){var g=a(".rating span").hasClass("star"),h=a(".studentquiz-comment-replies > div.studentquiz-comment-post").hasClass("fromcreator");return b&&(g||(a(".studentquiz_behaviour > .rate > .rate_error").removeClass("hide"),a(".studentquiz_behaviour .rate .rating .rateable:first-child").focus())),d&&(h||a(e).removeClass("hide")),!(b&&!g||d&&!h)&&(c.submit(),!0)}return c.submit(),!0})},setFocus:function(){a(document).ready(function(){var b=a("#categoryquestions .iconsort");b&&b.parent().focus()})},addRating:function(b){var c=a(b).attr("data-rate"),d=a(b),e=a(b).closest("form").find(".cmid_field"),f=e.attr("value");a.post(M.cfg.wwwroot+"/mod/studentquiz/save.php",{save:"rate",cmid:f,questionid:a(b).attr("data-questionid"),sesskey:M.cfg.sesskey,rate:c},function(){var b=d.closest(".rating").children("span");b.removeClass("star"),b.addClass("star-empty"),b.each(function(){a(this).attr("data-rate")<=c&&(a(this).removeClass("star-empty"),a(this).addClass("star"))}),a(".studentquiz_behaviour > .rate > .rate_error").addClass("hide")})}};return c});