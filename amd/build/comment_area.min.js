define(["jquery","core/str","core/ajax","core/modal_factory","core/templates","core/fragment","core/modal_events"],function(a,b,c,d,e,f,g){var h={EMPTY_CONTENT:["<br><p><br></p>","<p><br></p>","<br>",""],ATTO_HEIGHT:125,ROOT_COMMENT_VALUE:0,TEMPLATE_COMMENTS:"mod_studentquiz/comments",TEMPLATE_COMMENT:"mod_studentquiz/comment",ACTION_CREATE:"mod_studentquiz_create_comment",ACTION_CREATE_REPLY:"mod_studentquiz_create_reply",ACTION_GET_ALL:"mod_studentquiz_get_comments",ACTION_EXPAND:"mod_studentquiz_expand_comment",ACTION_DELETE:"mod_studentquiz_delete_comment",ACTION_LOAD_FRAGMENT_FORM:"mod_studentquiz_load_fragment_form",FRAGMENT_FORM_CALLBACK:"commentform",SELECTOR:{EXPAND_ALL:".studentquiz-comment-expand",COLLAPSE_ALL:".studentquiz-comment-collapse",SUBMIT_BUTTON:"#id_submitbutton",CONTAINER_REPLIES:".studentquiz-container-replies",COMMENT_REPLIES_CONTAINER:".studentquiz-comment-replies",COMMENT_COUNT:".studentquiz-comment-postcount",COMMENT_TEXT:".studentquiz-comment-text",COMMENT_REPLIES_TEXT:".studentquiz-comment-replies .studentquiz-comment-text",LOADING_ICON:".studentquiz-comment-loading",COMMENT_AREA_FORM:"div.comment-area-form",FORM_SELECTOR:".studentquiz-comment-postform > div.comment-area-form",NO_COMMENT:".no-comment",COLLAPSE_LINK:".studentquiz-comment-collapselink",EXPAND_LINK:".studentquiz-comment-expandlink",COMMENT_ITEM:".studentquiz-comment-item",COMMENT_REPLIES_CONTAINER_TO_ITEM:".studentquiz-comment-replies .studentquiz-comment-item",FRAGMENT_FORM:".studentquiz-comment-postfragmentform",BTN_DELETE:".studentquiz-comment-btndelete",BTN_REPLY:".studentquiz-comment-btnreply",BTN_DELETE_REPLY:".studentquiz-comment-btndeletereply",ATTO_EDITOR_WRAP:".editor_atto_wrap",TEXTAREA:'textarea[id^="id_editor_question_"]',COMMENT_COUNT_NUMBER:".studentquiz-comment-count-number",COMMENT_COUNT_TEXT:".studentquiz-comment-count-text",ATTO:{CONTENT_WRAP:".editor_atto_content_wrap",CONTENT:".editor_atto_content",TOOLBAR:".editor_atto_toolbar"},COMMENT_ID:"#comment_",SPAN_COMMENT_ID:"#c",TOTAL_REPLY:".studentquiz-comment-totalreply"},get:function(){return{elementSelector:null,btnExpandAll:null,btnCollapseAll:null,commentReply:null,containerSelector:null,questionId:null,dialogue:null,loadingIcon:null,lastFocusElement:null,formSelector:null,contextId:null,userId:null,string:{},deleteDialog:null,postToDelete:null,hasExpanded:!1,canAddPlaceHolder:!0,numberToShow:5,cmId:null,countServerData:[],lastCurrentCount:0,lastTotal:0,expand:!1,referer:null,highlight:0,init:function(c){var d=this;d.elementSelector=a("#"+a.escapeSelector(c.id));var e=d.elementSelector;d.btnExpandAll=e.find(h.SELECTOR.EXPAND_ALL),d.btnCollapseAll=e.find(h.SELECTOR.COLLAPSE_ALL),d.commentReply=e.find(h.SELECTOR.SUBMIT_BUTTON),d.containerSelector=e.find(h.SELECTOR.CONTAINER_REPLIES),d.loadingIcon=e.find(h.SELECTOR.LOADING_ICON),d.formSelector=e.find(h.SELECTOR.FORM_SELECTOR),d.questionId=parseInt(c.questionid),d.contextId=parseInt(c.contextid),d.userId=parseInt(c.userid),d.numberToShow=parseInt(c.numbertoshow),d.cmId=parseInt(c.cmid),d.countServerData={count:c.count,total:c.total},d.expand=c.expand||!1,d.referer=c.referer,b.get_strings([{key:"required",component:"core"},{key:"deletecomment",component:"mod_studentquiz"},{key:"confirmdeletecomment",component:"mod_studentquiz"},{key:"delete",component:"mod_studentquiz"},{key:"cancel",component:"core"},{key:"reply",component:"mod_studentquiz"},{key:"replies",component:"mod_studentquiz"},{key:"editorplaceholder",component:"mod_studentquiz"},{key:"error",component:"core"}]).done(function(a){d.string={required:a[0],deletecomment:a[1],confirmdelete:a[2],"delete":a[3],cancel:a[4],reply:a[5],replies:a[6],editor:{placeholder:a[7]},error:a[8]}}),this.initServerRender(),this.bindEvents()},initServerRender:function(){var b=this;a(h.SELECTOR.COMMENT_ITEM).each(function(){var c=a(this).data("id"),d=a(this).find(h.SELECTOR.SPAN_COMMENT_ID+c),e=[];b.expand&&(e=d.data("replies")||[]);var f={id:a(this).data("id"),deleted:d.data("deleted"),numberofreply:d.data("numberofreply"),expand:b.expand,replies:e,root:!0,authorid:d.data("authorid")};b.bindCommentEvent(f)}),b.changeWorkingState(!0),b.initBindEditor(),b.updateCommentCount(b.countServerData.count.commentcount,b.countServerData.total),b.countServerData.count.commentcount>0&&b.btnExpandAll.show(),b.changeWorkingState(!1);var c=window.location.search.substring(1),d=b.parseQueryString(c);if(b.highlight=parseInt(d.highlight)||0,0!==b.highlight){var e=a(h.SELECTOR.COMMENT_ID+b.highlight);console.log(e),e.addClass("highlight"),b.scrollToElement(e)}},initCommentArea:function(){var a=this;a.changeWorkingState(!0),a.containerSelector.empty(),a.loadingIcon.show(),a.initBindEditor(),M.util.js_pending(h.ACTION_GET_ALL),a.getComments(a.numberToShow,function(b){var c=a.countCommentAndReplies(b.data),d=c.commentCount,e=c.totalDelete;0!==d||0!==e?(a.btnExpandAll.show(),a.updateCommentCount(d,b.total),a.renderComment(b.data,!1)):(a.loadingIcon.hide(),a.changeWorkingState(!1),a.updateCommentCount(0,0)),M.util.js_complete(h.ACTION_GET_ALL)})},initBindEditor:function(){var a=this,b=setInterval(function(){0!==a.formSelector.find(h.SELECTOR.ATTO.CONTENT).length&&(a.initAttoEditor(a.formSelector),clearInterval(b))},500);a.bindEditorEvent(a.formSelector)},bindEvents:function(){var a=this;this.btnExpandAll.click(function(){a.containerSelector.empty(),a.btnExpandAll.hide(),a.btnCollapseAll.show(),a.loadingIcon.show(),a.changeWorkingState(!0),a.lastFocusElement=a.btnCollapseAll,M.util.js_pending(h.ACTION_GET_ALL),a.getComments(0,function(b){var c=a.countCommentAndReplies(b.data),d=c.total;a.updateCommentCount(d,b.total),a.renderComment(b.data,!0),M.util.js_complete(h.ACTION_GET_ALL)})}),this.btnCollapseAll.click(function(){a.loadingIcon.show(),a.btnCollapseAll.hide(),a.containerSelector.empty(),a.btnExpandAll.show(),a.lastFocusElement=a.btnExpandAll,a.initCommentArea()}),this.commentReply.click(function(){var b=h.ROOT_COMMENT_VALUE,c=a.questionId+"_"+b,d=a.formSelector,e=a.convertFormToJson(d);if(0===e["message[text]"].length){var f=d.find(h.SELECTOR.ATTO_EDITOR_WRAP);return 0===f.length||f.hasClass("error")||(f.addClass("error"),f.prepend('<span class="error" tabindex="0">'+a.string.required+"</span>")),!1}a.changeWorkingState(!0),a.loadingIcon.show();var g={replyto:b,message:{text:e["message[text]"],format:e["message[format]"]}};return a.createComment(g,function(b){setTimeout(function(){d.trigger("reset"),d.find("#id_editor_question_"+c+"editable").empty()}),b.replies=[],d.find(h.SELECTOR.SUBMIT_BUTTON).addClass("disabled"),a.appendComment(b,a.elementSelector.find(h.SELECTOR.CONTAINER_REPLIES))}),!0})},getComments:function(a,b){var d=this,e=d.getParamsBeforeCallApi({numbertoshow:a});c.call([{methodname:h.ACTION_GET_ALL,args:e,done:function(a){b(a)},fail:function(a){d.showError(a.message)}}])},getParamsBeforeCallApi:function(a){var b=this;return a.questionid=b.questionId,a.cmid=b.cmId,a},showError:function(b){var c=this;a.when(c.string.error).done(function(a){c.showDialog(a,b),c.changeWorkingState(!1)})},showDialog:function(a,b){var c=this,e=c.dialogue;e?(e.title.html(a),e.body.html(b),e.show()):d.create({type:d.types.DEFAULT,title:a,body:b}).done(function(a){e=a,e.show()})},updateCommentCount:function(c,d){var e=this;d===-1?d=e.lastTotal:e.lastTotal=d,c===-1?c=e.lastCurrentCount:e.lastCurrentCount=c;var f=b.get_string("current_of_total","studentquiz",{current:c,total:d}),g=a(h.SELECTOR.NO_COMMENT);g.length>0&&c>0&&g.hide(),a.when(f).done(function(a){e.elementSelector.find(h.SELECTOR.COMMENT_COUNT).text(a)})},renderComment:function(b,c){var d=this;return b=d.convertForTemplate(b,c),e.render(h.TEMPLATE_COMMENTS,{comments:b}).done(function(c){d.containerSelector.append(a(c));for(var e=0;e<b.length;e++)d.bindCommentEvent(b[e]);d.changeWorkingState(!1),d.loadingIcon.hide()}),!1},bindCommentEvent:function(a){var b=this,c=b.containerSelector.find(h.SELECTOR.COMMENT_ID+a.id),d=0;if(a.root&&a.hasOwnProperty("replies"))for(d;d<a.replies.length;d++){var e=a.replies[d];b.bindReplyEvent(e,c)}c.find(h.SELECTOR.BTN_DELETE).click(function(c){b.bindDeleteEvent(a),c.preventDefault()}),c.find(h.SELECTOR.BTN_REPLY).click(function(c){c.preventDefault(),b.getFragmentFormReplyEvent(a)}),c.find(h.SELECTOR.EXPAND_LINK).click(function(c){c.preventDefault(),b.bindExpandEvent(a)}),c.find(h.SELECTOR.COLLAPSE_LINK).click(function(c){c.preventDefault(),b.bindCollapseEvent(a)})},bindReplyEvent:function(a,b){var c=this,d=b.find(h.SELECTOR.COMMENT_ID+a.id);d.find(h.SELECTOR.BTN_DELETE_REPLY).click(function(b){c.bindDeleteEvent(a),b.preventDefault()})},changeWorkingState:function(a){var b=a?"hidden":"visible",c=this;0===c.lastCurrentCount&&(b="hidden"),c.btnExpandAll.prop("disabled",a),c.btnCollapseAll.prop("disabled",a),c.elementSelector.find(h.SELECTOR.BTN_REPLY).prop("disabled",a),c.elementSelector.find(h.SELECTOR.BTN_DELETE).prop("disabled",a),c.elementSelector.find(h.SELECTOR.BTN_DELETE_REPLY).prop("disabled",a),c.elementSelector.find(h.SELECTOR.EXPAND_LINK).css("visibility",b),c.elementSelector.find(h.SELECTOR.COLLAPSE_LINK).css("visibility",b),c.deleteDialog&&(c.deleteDialog.getFooter().find('button[data-action="yes"]').prop("disabled",a),c.deleteDialog.getFooter().find('button[data-action="yesandemail"]').prop("disabled",a)),a?c.commentReply.prop("disabled",a):c.lastFocusElement&&(c.lastFocusElement.focus(),c.lastFocusElement=null)},countCommentAndReplies:function(a){var b=0,c=0,d=0,e=0;a.constructor!==Array&&(a=[a]);for(var f=0;f<a.length;f++){var g=a[f];0===g.deletedtime?b++:c++;for(var h=0;h<g.replies.length;h++){var i=g.replies[h];0===i.deletedtime?d++:e++}}return{total:b+d,totalDelete:c+e,commentCount:b,deleteCommentCount:c,replyCount:d,deleteReplyCount:e}},expandComment:function(a,b){var d=this,e=d.getParamsBeforeCallApi({commentid:a});c.call([{methodname:h.ACTION_EXPAND,args:e,done:function(a){b(a)},fail:function(a){d.showError(a.message)}}])},bindExpandEvent:function(b){var c=this,d=c.elementSelector.find(h.SELECTOR.COMMENT_ID+b.id),f=h.ACTION_EXPAND,g=c.loadingIcon.clone().show();c.changeWorkingState(!0),d.find(h.SELECTOR.COMMENT_REPLIES_CONTAINER).append(g),a(c).hide(),M.util.js_pending(f),c.expandComment(b.id,function(g){for(var i=c.convertForTemplate(g,!0),j=0;j<i.replies.length;j++){var k=i.replies[j];k.deleted&&!k.canviewdeleted&&(i.replies.splice(j,1),j--)}var l=d.find(h.SELECTOR.COMMENT_REPLIES_CONTAINER_TO_ITEM).length,m=c.countCommentAndReplies(i).replyCount,n=c.lastCurrentCount+m-l,o=c.lastTotal+(i.numberofreply-b.numberofreply);b.deleted&&!i.deleted&&(n++,o++),!b.deleted&&i.deleted&&(n--,o--),n===o&&(c.btnExpandAll.hide(),c.btnCollapseAll.show()),c.updateCommentCount(n,o),e.render(h.TEMPLATE_COMMENT,i).done(function(b){var e=a(b);d.replaceWith(e),c.lastFocusElement=e.find(h.SELECTOR.COLLAPSE_LINK),c.bindCommentEvent(g),c.changeWorkingState(!1),M.util.js_complete(f)})})},bindCollapseEvent:function(a){var b=this,c=b.elementSelector.find(h.SELECTOR.COMMENT_ID+a.id),d=c.find(h.SELECTOR.COMMENT_REPLIES_TEXT).length;b.updateCommentCount(b.lastCurrentCount-d,-1),a.numberofreply=d,c.find(h.SELECTOR.COMMENT_REPLIES_CONTAINER).empty(),a.deleted?c.find(".studentquiz-comment-delete-content").html(a.shortcontent):c.find(h.SELECTOR.COMMENT_TEXT).html(a.shortcontent),c.find(h.SELECTOR.COLLAPSE_LINK).hide(),c.find(h.SELECTOR.EXPAND_LINK).show().focus(),a.expanded=!1},convertForTemplate:function(a,b){var c=this,d=!1;a.constructor!==Array&&(a=[a],d=!0);var e=0;for(e;e<a.length;e++){var f=a[e];f.expanded=b,c.referer&&(f.reportlink=f.reportlink+"&referer="+c.referer);var g=0;for(g;g<f.replies.length;g++){var h=f.replies[g];c.referer&&(h.reportlink=h.reportlink+"&referer="+c.referer)}}return d?a[0]:a},convertFormToJson:function(b){var c={};return b.find(":input").each(function(){var b=a(this).prop("type"),d=a(this).attr("name");(("checkbox"===b||"radio"===b)&&this.checked||"button"!==b&&"submit"!==b)&&(c[d]=a(this).val())}),c},createComment:function(a,b){var d=this;a=d.getParamsBeforeCallApi(a),c.call([{methodname:h.ACTION_CREATE,args:a,done:function(a){b(a)},fail:function(b){d.showError(b.message),d.elementSelector.find(h.SELECTOR.COMMENT_ID+a.replyto+" "+h.SELECTOR.FRAGMENT_FORM).empty()}}])},appendComment:function(b,c,d){var f=this;b=f.convertForTemplate(b,!0),b.root=!d,e.render(h.TEMPLATE_COMMENT,b).done(function(e){var g=a(e);c.append(g),f.lastCurrentCount?f.updateCommentCount(f.lastCurrentCount+1,f.lastTotal+1):(f.updateCommentCount(1,1),f.btnCollapseAll.prop("disabled",!1),f.btnCollapseAll.show()),d?f.bindReplyEvent(b,g.parent()):f.bindCommentEvent(b),f.loadingIcon.hide(),f.changeWorkingState(!1)})},loadFragmentForm:function(a,b){var c=this,d=c.getParamsBeforeCallApi({replyto:b.id,cancelbutton:!0}),g=c.formSelector.find(h.SELECTOR.ATTO_EDITOR_WRAP);0!==g.length&&g.hasClass("error")&&(g.removeClass("error"),g.find("#id_error_message_5btext_5d").remove());var i=h.ACTION_LOAD_FRAGMENT_FORM;M.util.js_pending(i),f.loadFragment("mod_studentquiz",h.FRAGMENT_FORM_CALLBACK,c.contextId,d).done(function(d,f){e.replaceNodeContents(a,d,f),a.find("#id_message"+b.id+"editable").focus(),M.util.js_complete(i),c.bindFragmentFormEvent(a,b)})},bindFragmentFormEvent:function(a,b){var c=this,d=a.find(h.SELECTOR.COMMENT_AREA_FORM);a.find(h.SELECTOR.SUBMIT_BUTTON).click(function(){var e=c.convertFormToJson(d);if(0===e["message[text]"].length)return!0;var f=c.loadingIcon.clone().show();return f.appendTo(a),d.hide(),c.changeWorkingState(!0),c.createReplyComment(a,b,d,e),!0}),c.fragmentFormCancelEvent(d),c.bindEditorEvent(a)},createReplyComment:function(a,b,c,d){var e=this,f={replyto:b.id,message:{text:d["message[text]"],format:d["message[format]"]}};M.util.js_pending(h.ACTION_CREATE_REPLY),e.createComment(f,function(c){var d=e.elementSelector.find(h.SELECTOR.COMMENT_ID+b.id),f=d.find(h.SELECTOR.COMMENT_REPLIES_CONTAINER);b.numberofreply++;var g=parseInt(d.find(h.SELECTOR.COMMENT_COUNT_NUMBER).text())+1;d.find(h.SELECTOR.COMMENT_COUNT_NUMBER).text(g),d.find(h.SELECTOR.COMMENT_COUNT_TEXT).html(1===g?e.string.reply:e.string.replies),a.empty(),c.replies=[],e.appendComment(c,f,!0),M.util.js_complete(h.ACTION_CREATE_REPLY)})},getFragmentFormReplyEvent:function(a){var b=this,c=b.elementSelector.find(h.SELECTOR.COMMENT_ID+a.id),d=c.find(h.SELECTOR.FRAGMENT_FORM).first(),e=b.loadingIcon.clone().show();d.append(e),b.loadFragmentForm(d,a),b.changeWorkingState(!0)},fragmentFormCancelEvent:function(a){var b=this,c=a.find("#id_cancel");c.click(function(c){c.preventDefault();var d=a.closest(h.SELECTOR.COMMENT_ITEM);b.lastFocusElement=d.find(h.SELECTOR.BTN_REPLY),b.changeWorkingState(!1),a.parent().empty()})},bindDeleteEvent:function(b){var c=this;c.postToDelete=b,c.deleteDialog?c.deleteDialog.show():(c.changeWorkingState(!0),d.create({type:d.types.DEFAULT,title:c.string.deletecomment,body:c.string.confirmdelete,footer:'<button type="button" data-action="yes" title="'+c.string.deletecomment+'">'+c.string["delete"]+'</button><button type="button" data-action="no" title="'+c.string.cancel+'">'+c.string.cancel+"</button>"}).done(function(b){c.deleteDialog=b,b.getFooter().find('button[data-action="no"]').click(function(a){a.preventDefault(),b.hide()}),b.getFooter().find('button[data-action="yes"]').click(function(d){d.preventDefault(),M.util.js_pending(h.ACTION_DELETE),c.changeWorkingState(!0),c.deleteComment(c.postToDelete.id,function(d){if(d.success){var f=d.data,g=a(h.SELECTOR.COMMENT_ID+f.id);f.replies=[];var i=c.convertForTemplate(f,c.postToDelete.expanded);i.root=c.postToDelete.root,i.root||(i.expanded=!0),e.render(h.TEMPLATE_COMMENT,i).done(function(b){var d=a(b);if(!i.root){var e=g.parent().closest(h.SELECTOR.COMMENT_ITEM).find(h.TOTAL_REPLY),j=e.find(h.SELECTOR.COMMENT_COUNT_NUMBER),k=parseInt(j.text())-1;e.find(h.SELECTOR.COMMENT_COUNT_NUMBER).text(k),e.find(h.SELECTOR.COMMENT_COUNT_TEXT).html(1===k?c.string.reply:c.string.replies)}var l=g.find(h.SELECTOR.COMMENT_REPLIES_CONTAINER).clone(!0);g.replaceWith(d),d.find(h.SELECTOR.COMMENT_REPLIES_CONTAINER).replaceWith(l),c.updateCommentCount(c.lastCurrentCount-1,c.lastTotal-1),c.postToDelete.root?c.bindCommentEvent(f):c.bindReplyEvent(f,d.parent()),c.changeWorkingState(!1),M.util.js_complete(h.ACTION_DELETE)})}else c.showError(d.message);b.hide()})}),b.getRoot().on(g.hidden,function(){var b=a(h.SELECTOR.COMMENT_ID+c.postToDelete.id);c.postToDelete.root?b.find(h.SELECTOR.BTN_DELETE).first().focus():b.find(h.SELECTOR.BTN_DELETE_REPLY).first().focus()}),b.getRoot().on(g.shown,function(){c.changeWorkingState(!1)}),b.show(),c.changeWorkingState(!1)}))},deleteComment:function(a,b){var d=this,e=d.getParamsBeforeCallApi({commentid:a});c.call([{methodname:h.ACTION_DELETE,args:e,done:function(a){b(a)},fail:function(a){d.showError(a.message)}}])},initAttoEditor:function(a){var b=this,c=h.ATTO_HEIGHT,d=a.find(h.SELECTOR.ATTO.CONTENT_WRAP),e=a.find(h.SELECTOR.ATTO.CONTENT),f=a.find("textarea");M.util.js_pending("init_editor"),b.addRemovePlaceHolder(e,d,f),a.find(h.SELECTOR.ATTO.CONTENT+", textarea").focus(function(g){g.preventDefault(),b.hasExpanded||(M.util.js_pending("expand_editor"),a.find(h.SELECTOR.ATTO.TOOLBAR).fadeIn(),e.is(":visible")&&e.height()<c&&(e.animate({height:c},200),f.height(c)),f.is(":visible")&&f.height()<c&&(f.animate({height:c},200),e.height(c)),d.attr("data-placeholder",""),f.attr("placeholder",""),b.canAddPlaceHolder=!1,b.hasExpanded=!0,M.util.js_complete("expand_editor"))}),M.util.js_complete("init_editor")},addRemovePlaceHolder:function(a,b,c){var d=this;if(d.canAddPlaceHolder){if(!(h.EMPTY_CONTENT.indexOf(a.html())>-1))return b.attr("data-placeholder",""),c.attr("placeholder",""),void(d.canAddPlaceHolder=!1);var e=d.string.editor.placeholder;b.attr("data-placeholder",e).addClass("force-redraw").removeClass("force-redraw"),c.attr("placeholder",e),setTimeout(function(){d.addRemovePlaceHolder(a,b,c)},250)}},bindEditorEvent:function(b){var c="text_change_"+Date.now(),d=b.find(h.SELECTOR.SUBMIT_BUTTON);d.addClass("disabled");var e=b.find(h.SELECTOR.TEXTAREA);e.on("change",function(){M.util.js_pending(c),h.EMPTY_CONTENT.indexOf(a(this).val())>-1?(d.addClass("disabled"),d.prop("disabled",!0)):(d.removeClass("disabled"),d.prop("disabled",!1)),M.util.js_complete(c)});var f=setInterval(function(){b.find('textarea[id^="id_message"]').trigger("change")},350);setTimeout(function(){clearInterval(f)},5e3)},parseQueryString:function(a){for(var b=a.split("&"),c={},d=0;d<b.length;d++){var e=b[d].split("="),f=decodeURIComponent(e[0]),g=decodeURIComponent(e[1]);"undefined"==typeof c[f]?c[f]=decodeURIComponent(g):"string"==typeof c[f]?c[f]=[c[f],decodeURIComponent(g)]:c[f].push(decodeURIComponent(g))}return c},scrollToElement:function(b,c){if(b.length){"undefined"==typeof c&&(c=1e3);var d=b.offset().top;a("html,body").animate({scrollTop:d},c)}}}},generate:function(a){var b=h.get();b.init(JSON.parse(a))}};return h});