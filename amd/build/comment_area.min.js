define(["jquery","core/str","core/ajax","core/modal_factory","core/templates","core/fragment","core/modal_events"],function(a,b,c,d,e,f,g){var h={EMPTY_CONTENT:["<br><p><br></p>","<p><br></p>","<br>",""],ROOT_COMMENT_VALUE:0,GET_ALL_VALUE:0,TEMPLATE_COMMENTS:"mod_studentquiz/comments",TEMPLATE_COMMENT:"mod_studentquiz/comment",ACTION_CREATE:"mod_studentquiz_create_comment",ACTION_CREATE_REPLY:"mod_studentquiz_create_reply",ACTION_GET_ALL:"mod_studentquiz_get_comments",ACTION_EXPAND:"mod_studentquiz_expand_comment",ACTION_DELETE:"mod_studentquiz_delete_comment",ACTION_LOAD_FRAGMENT_FORM:"mod_studentquiz_load_fragment_form",ACTION_EXPAND_ALL:"action_expand_all",ACTION_COLLAPSE_ALL:"action_collapse_all",ACTION_RENDER_COMMENT:"action_render_comment",ACTION_APPEND_COMMENT:"action_append_comment",FRAGMENT_FORM_CALLBACK:"commentform",SELECTOR:{EXPAND_ALL:".studentquiz-comment-expand",COLLAPSE_ALL:".studentquiz-comment-collapse",SUBMIT_BUTTON:"#id_submitbutton",CONTAINER_REPLIES:".studentquiz-container-replies",COMMENT_REPLIES_CONTAINER:".studentquiz-comment-replies",COMMENT_COUNT:".studentquiz-comment-postcount",COMMENT_TEXT:".studentquiz-comment-text",COMMENT_REPLIES_TEXT:".studentquiz-comment-replies .studentquiz-comment-text",LOADING_ICON:".studentquiz-comment-loading",COMMENT_AREA_FORM:"div.comment-area-form",FORM_SELECTOR:".studentquiz-comment-postform > div.comment-area-form",NO_COMMENT:".no-comment",COLLAPSE_LINK:".studentquiz-comment-collapselink",EXPAND_LINK:".studentquiz-comment-expandlink",COMMENT_ITEM:".studentquiz-comment-item",COMMENT_REPLIES_CONTAINER_TO_ITEM:".studentquiz-comment-replies .studentquiz-comment-item",FRAGMENT_FORM:".studentquiz-comment-postfragmentform",BTN_DELETE:".studentquiz-comment-btndelete",BTN_REPLY:".studentquiz-comment-btnreply",BTN_DELETE_REPLY:".studentquiz-comment-btndeletereply",ATTO_EDITOR_WRAP:".editor_atto_wrap",TEXTAREA:'textarea[id^="id_editor_question_"]',COMMENT_COUNT_NUMBER:".studentquiz-comment-count-number",COMMENT_COUNT_TEXT:".studentquiz-comment-count-text",ATTO:{CONTENT_WRAP:".editor_atto_content_wrap",CONTENT:".editor_atto_content",TOOLBAR:".editor_atto_toolbar"},COMMENT_ID:"#comment_",SPAN_COMMENT_ID:"#c",TOTAL_REPLY:".studentquiz-comment-totalreply",COMMENT_FILTER:".studentquiz-comment-filter",COMMENT_FILTER_HIDE:".hide-comment-filter",COMMENT_ERROR:".studentquiz-comment-container .comment-error"},get:function(){return{elementSelector:null,btnExpandAll:null,btnCollapseAll:null,addComment:null,containerSelector:null,questionId:null,dialogue:null,loadingIcon:null,lastFocusElement:null,formSelector:null,contextId:null,userId:null,string:{},deleteDialog:null,postToDelete:null,hasExpanded:!1,canAddPlaceHolder:!0,numberToShow:5,cmId:null,countServerData:[],lastCurrentCount:0,lastTotal:0,expand:!1,textareaPlaceholder:"",forceCommenting:!1,canViewDeleted:!1,init:function(b){var c=this;c.elementSelector=a("#"+a.escapeSelector(b.id));var d=c.elementSelector;c.btnExpandAll=d.find(h.SELECTOR.EXPAND_ALL),c.btnCollapseAll=d.find(h.SELECTOR.COLLAPSE_ALL),c.addComment=d.find(h.SELECTOR.SUBMIT_BUTTON),c.containerSelector=d.find(h.SELECTOR.CONTAINER_REPLIES),c.loadingIcon=d.find(h.SELECTOR.LOADING_ICON),c.formSelector=d.find(h.SELECTOR.FORM_SELECTOR),c.questionId=parseInt(b.questionid),c.contextId=parseInt(b.contextid),c.userId=parseInt(b.userid),c.numberToShow=parseInt(b.numbertoshow),c.cmId=parseInt(b.cmid),c.countServerData={count:b.count,total:b.total},c.expand=b.expand||!1,c.textareaPlaceholder=c.formSelector.attr("data-textarea-placeholder"),c.string=b.strings,c.forceCommenting=b.forcecommenting,c.canViewDeleted=b.canviewdeleted,this.initServerRender(),this.bindEvents()},initServerRender:function(){var b=this;a(h.SELECTOR.COMMENT_ITEM).each(function(){var c=a(this).data("id"),d=a(this).find(h.SELECTOR.SPAN_COMMENT_ID+c),e=[];b.expand&&(e=d.data("replies")||[]);var f={id:a(this).data("id"),deleted:d.data("deleted"),numberofreply:d.data("numberofreply"),expanded:b.expand,replies:e,root:!0,authorid:d.data("authorid")};b.bindCommentEvent(f)}),b.changeWorkingState(!0),b.initBindEditor(),b.updateCommentCount(b.countServerData.count.commentcount,b.countServerData.total),b.btnExpandAll.show(),b.changeWorkingState(!1)},initBindEditor:function(){var a=this,b=setInterval(function(){0!==a.formSelector.find(h.SELECTOR.ATTO.CONTENT).length&&(a.initAttoEditor(a.formSelector),a.bindEditorEvent(a.formSelector),clearInterval(b))},500)},bindEvents:function(){var b=this;b.btnExpandAll.click(function(a){a.preventDefault(),M.util.js_pending(h.ACTION_EXPAND_ALL),b.changeWorkingState(!0),b.containerSelector.empty(),b.btnExpandAll.hide(),b.btnCollapseAll.show(),b.loadingIcon.show(),b.getComments(h.GET_ALL_VALUE).then(function(a){var c=b.countCommentAndReplies(a.data),d=c.total;b.updateCommentCount(d,a.total),b.renderComment(a.data,!0),M.util.js_complete(h.ACTION_EXPAND_ALL)}).fail(function(a){M.util.js_complete(h.ACTION_EXPAND_ALL),b.showError(a.message)})}),b.btnCollapseAll.click(function(a){a.preventDefault(),M.util.js_pending(h.ACTION_COLLAPSE_ALL),b.changeWorkingState(!0),b.loadingIcon.show(),b.btnCollapseAll.hide(),b.btnExpandAll.show(),b.containerSelector[0].innerHTML="",b.getComments(b.numberToShow).then(function(a){var c=b.countCommentAndReplies(a.data),d=c.commentCount,e=c.totalDelete;0!==d||0!==e?(b.btnExpandAll.show(),b.updateCommentCount(d,a.total),b.renderComment(a.data,!1)):(b.loadingIcon.hide(),b.changeWorkingState(!1),b.updateCommentCount(0,0)),M.util.js_complete(h.ACTION_COLLAPSE_ALL)}).fail(function(a){M.util.js_complete(h.ACTION_COLLAPSE_ALL),b.showError(a.message)})}),b.addComment.click(function(){M.util.js_pending(h.ACTION_CREATE),b.changeWorkingState(!0),b.loadingIcon.show(),a(h.SELECTOR.COMMENT_ERROR).hide(),a(h.SELECTOR.NO_COMMENT).hide();var c=h.ROOT_COMMENT_VALUE,d=b.questionId+"_"+c,e=b.formSelector,f=b.convertFormToJson(e);if(0===f["message[text]"].length){var g=e.find(h.SELECTOR.ATTO_EDITOR_WRAP);return 0===g.length||g.hasClass("error")||(g.addClass("error"),g.prepend('<span class="error" tabindex="0">'+b.string.required+"</span>")),!1}var i={replyto:c,message:{text:f["message[text]"],format:f["message[format]"]}};return b.createComment(i).then(function(a){return setTimeout(function(){e.trigger("reset"),e.find("#id_editor_question_"+d+"editable").empty()}),a.replies=[],e.find(h.SELECTOR.SUBMIT_BUTTON).addClass("disabled"),b.appendComment(a,b.elementSelector.find(h.SELECTOR.CONTAINER_REPLIES)),M.util.js_complete(h.ACTION_CREATE),!0}).fail(function(a){b.handleFailWhenCreateComment(a,i),M.util.js_complete(h.ACTION_CREATE)}),!0})},getComments:function(a){var b=this,d=b.getParamsBeforeCallApi({numbertoshow:a}),e=c.call([{methodname:h.ACTION_GET_ALL,args:d}]);return e[0]},getParamsBeforeCallApi:function(a){var b=this;return a.questionid=b.questionId,a.cmid=b.cmId,a},showError:function(b){var c=this;a.when(c.string.error).done(function(a){c.showDialog(a,b),c.changeWorkingState(!1)})},showDialog:function(a,b){var c=this,e=c.dialogue;e?(e.title.html(a),e.body.html(b),e.show()):d.create({type:d.types.CANCEL,title:a,body:b}).done(function(a){e=a,e.show(),a.getRoot().on(g.hidden,{},function(){location.reload()})})},updateCommentCount:function(c,d){var e=this;d===-1?d=e.lastTotal:e.lastTotal=d,c===-1?c=e.lastCurrentCount:e.lastCurrentCount=c;var f=b.get_string("current_of_total","studentquiz",{current:c,total:d}),g=a(h.SELECTOR.NO_COMMENT),i=a(h.SELECTOR.COMMENT_FILTER),j=e.checkEmptyElement(a(h.SELECTOR.COMMENT_REPLIES_CONTAINER));0===e.lastCurrentCount&&j?(a(h.SELECTOR.COMMENT_REPLIES_CONTAINER).hide(),i.hide(),g.show()):(a(h.SELECTOR.COMMENT_REPLIES_CONTAINER).show(),g.hide(),i.show()),a.when(f).done(function(a){e.elementSelector.find(h.SELECTOR.COMMENT_COUNT).text(a)})},renderComment:function(a,b){var c=this;return M.util.js_pending(h.ACTION_RENDER_COMMENT),a=c.convertForTemplate(a,b),e.render(h.TEMPLATE_COMMENTS,{comments:a}).done(function(b){c.containerSelector[0].innerHTML=b,c.loadingIcon.hide();for(var d=0;d<a.length;d++)c.bindCommentEvent(a[d]);c.changeWorkingState(!1),M.util.js_complete(h.ACTION_RENDER_COMMENT)}),!1},bindCommentEvent:function(a){var b=this,c=b.containerSelector.find(h.SELECTOR.COMMENT_ID+a.id),d=0;for(d;d<a.replies.length;d++){var e=a.replies[d];b.bindReplyEvent(e,c)}c.find(h.SELECTOR.BTN_DELETE).click(function(c){b.bindDeleteEvent(a),c.preventDefault()}),c.find(h.SELECTOR.BTN_REPLY).click(function(c){c.preventDefault(),b.getFragmentFormReplyEvent(a)}),c.find(h.SELECTOR.EXPAND_LINK).click(function(c){c.preventDefault(),b.bindExpandEvent(a)}),c.find(h.SELECTOR.COLLAPSE_LINK).click(function(c){c.preventDefault(),b.bindCollapseEvent(a)})},bindReplyEvent:function(a,b){var c=this,d=b.find(h.SELECTOR.COMMENT_ID+a.id);d.find(h.SELECTOR.BTN_DELETE_REPLY).click(function(b){c.bindDeleteEvent(a),b.preventDefault()})},changeWorkingState:function(a){var b=a?"hidden":"visible",c=this;c.btnExpandAll.prop("disabled",a),c.btnCollapseAll.prop("disabled",a),c.elementSelector.find(h.SELECTOR.BTN_REPLY).prop("disabled",a),c.elementSelector.find(h.SELECTOR.BTN_DELETE).prop("disabled",a),c.elementSelector.find(h.SELECTOR.BTN_DELETE_REPLY).prop("disabled",a),c.elementSelector.find(h.SELECTOR.EXPAND_LINK).css("visibility",b),c.elementSelector.find(h.SELECTOR.COLLAPSE_LINK).css("visibility",b),c.deleteDialog&&c.deleteDialog.getFooter().find('button[data-action="yes"]').prop("disabled",a),a?c.addComment.prop("disabled",a):c.lastFocusElement&&(c.lastFocusElement.focus(),c.lastFocusElement=null)},countCommentAndReplies:function(a){var b=0,c=0,d=0,e=0;a.constructor!==Array&&(a=[a]);for(var f=0;f<a.length;f++){var g=a[f];0==g.deletedtime?b++:c++;for(var h=0;h<g.replies.length;h++){var i=g.replies[h];0==i.deletedtime?d++:e++}}return{total:b+d,totalDelete:c+e,commentCount:b,deleteCommentCount:c,replyCount:d,deleteReplyCount:e}},expandComment:function(a){var b=this,d=b.getParamsBeforeCallApi({commentid:a}),e=c.call([{methodname:h.ACTION_EXPAND,args:d}]);return e[0]},bindExpandEvent:function(b){var c=this,d=c.elementSelector.find(h.SELECTOR.COMMENT_ID+b.id),f=h.ACTION_EXPAND;M.util.js_pending(f),c.changeWorkingState(!0);var g=c.loadingIcon.clone().show();d.find(h.SELECTOR.COMMENT_REPLIES_CONTAINER).append(g),a(c).hide(),c.expandComment(b.id).then(function(g){var i=c.convertForTemplate(g,!0),j=d.find(h.SELECTOR.COMMENT_REPLIES_CONTAINER_TO_ITEM).length,k=c.countCommentAndReplies(i).replyCount,l=c.lastCurrentCount+k-j,m=c.lastTotal+(i.numberofreply-b.numberofreply);return b.deleted&&!i.deleted&&(l++,m++),!b.deleted&&i.deleted&&(l--,m--),l===m&&(c.btnExpandAll.hide(),c.btnCollapseAll.show()),c.updateCommentCount(l,m),e.render(h.TEMPLATE_COMMENT,i).done(function(b){var e=a(b);return d.replaceWith(e),c.lastFocusElement=e.find(h.SELECTOR.COLLAPSE_LINK),c.bindCommentEvent(g),c.changeWorkingState(!1),M.util.js_complete(f),!0})}).fail(function(a){M.util.js_complete(f),c.showError(a.message)})},bindCollapseEvent:function(a){var b=this,c=b.elementSelector.find(h.SELECTOR.COMMENT_ID+a.id),d=c.find(h.SELECTOR.COMMENT_REPLIES_TEXT).length;b.updateCommentCount(b.lastCurrentCount-d,-1),a.numberofreply=d,c.find(h.SELECTOR.COMMENT_REPLIES_CONTAINER).empty(),a.deleted?c.find(".studentquiz-comment-delete-content").html(a.shortcontent):c.find(h.SELECTOR.COMMENT_TEXT).html(a.shortcontent),c.find(h.SELECTOR.COLLAPSE_LINK).hide(),c.find(h.SELECTOR.EXPAND_LINK).show().focus(),a.expanded=!1},convertForTemplate:function(a,b){var c=this,d=!1;a.constructor!==Array&&(a=[a],d=!0);for(var e=0;e<a.length;e++){var f=a[e];f.expanded=b,f.canviewdeleted=c.canViewDeleted;for(var g=0;g<f.replies.length;g++){var h=f.replies[g];h.expanded=!0,h.canviewdeleted=c.canViewDeleted}}return d?a[0]:a},convertFormToJson:function(b){var c={};return b.find(":input").each(function(){var b=a(this).prop("type"),d=a(this).attr("name");(("checkbox"===b||"radio"===b)&&this.checked||"button"!==b&&"submit"!==b)&&(c[d]=a(this).val())}),c},createComment:function(a){var b=this;a=b.getParamsBeforeCallApi(a);var d=c.call([{methodname:h.ACTION_CREATE,args:a}]);return d[0]},appendComment:function(b,c,d){var f=this;M.util.js_pending(h.ACTION_APPEND_COMMENT),b.root=!d,b.expanded=!0,e.render(h.TEMPLATE_COMMENT,b).done(function(e){var g=a(e);c.append(g),f.lastCurrentCount?f.updateCommentCount(f.lastCurrentCount+1,f.lastTotal+1):(a(h.SELECTOR.COMMENT_FILTER).removeClass(h.SELECTOR.COMMENT_FILTER_HIDE),f.updateCommentCount(1,1),f.btnExpandAll.prop("disabled",!0),f.btnExpandAll.hide(),f.btnCollapseAll.prop("disabled",!1),f.btnCollapseAll.show(),f.expand=!0),d?f.bindReplyEvent(b,g.parent()):f.bindCommentEvent(b),f.loadingIcon.hide(),f.changeWorkingState(!1),M.util.js_complete(h.ACTION_APPEND_COMMENT)})},loadFragmentForm:function(a,b){var c=this,d=h.ACTION_LOAD_FRAGMENT_FORM;M.util.js_pending(d);var g=c.getParamsBeforeCallApi({replyto:b.id,cancelbutton:!0,forcecommenting:c.forceCommenting}),i=c.formSelector.find(h.SELECTOR.ATTO_EDITOR_WRAP);0!==i.length&&i.hasClass("error")&&(i.removeClass("error"),i.find("#id_error_message_5btext_5d").remove()),f.loadFragment("mod_studentquiz",h.FRAGMENT_FORM_CALLBACK,c.contextId,g).done(function(f,g){e.replaceNodeContents(a,f,g);var h="#id_editor_question_"+c.questionId+"_"+b.id+"editable";a.find(h).focus(),c.bindFragmentFormEvent(a,b),M.util.js_complete(d)})},bindFragmentFormEvent:function(a,b){var c=this,d=a.find(h.SELECTOR.COMMENT_AREA_FORM);a.find(h.SELECTOR.SUBMIT_BUTTON).click(function(){c.changeWorkingState(!0);var e=c.convertFormToJson(d);if(0===e["message[text]"].length)return!0;var f=c.loadingIcon.clone().show();return f.appendTo(a),d.hide(),c.createReplyComment(a,b,d,e),!0}),c.fragmentFormCancelEvent(d),c.bindEditorEvent(a)},createReplyComment:function(b,c,d,e){var f=this,g={replyto:c.id,message:{text:e["message[text]"],format:e["message[format]"]}};M.util.js_pending(h.ACTION_CREATE_REPLY),f.createComment(g).then(function(d){a(h.SELECTOR.COMMENT_ERROR).hide();var e=f.elementSelector.find(h.SELECTOR.COMMENT_ID+c.id),g=e.find(h.SELECTOR.COMMENT_REPLIES_CONTAINER);c.numberofreply++;var i=parseInt(e.find(h.SELECTOR.COMMENT_COUNT_NUMBER).text())+1;return e.find(h.SELECTOR.COMMENT_COUNT_NUMBER).text(i),e.find(h.SELECTOR.COMMENT_COUNT_TEXT).html(1===i?f.string.reply:f.string.replies),b.empty(),d.replies=[],f.appendComment(d,g,!0),M.util.js_complete(h.ACTION_CREATE_REPLY),!0}).fail(function(a){f.handleFailWhenCreateComment(a,g),M.util.js_complete(h.ACTION_CREATE_REPLY)})},handleFailWhenCreateComment:function(a,b){var c=this;c.showError(a.message);var d=h.SELECTOR.COMMENT_ID+b.replyto+" "+h.SELECTOR.FRAGMENT_FORM;c.elementSelector.find(d).empty()},getFragmentFormReplyEvent:function(a){var b=this,c=b.elementSelector.find(h.SELECTOR.COMMENT_ID+a.id),d=c.find(h.SELECTOR.FRAGMENT_FORM).first(),e=b.loadingIcon.clone().show();d.append(e),b.loadFragmentForm(d,a),b.changeWorkingState(!0)},fragmentFormCancelEvent:function(a){var b=this,c=a.find("#id_cancel");c.click(function(c){c.preventDefault();var d=a.closest(h.SELECTOR.COMMENT_ITEM);b.lastFocusElement=d.find(h.SELECTOR.BTN_REPLY),b.changeWorkingState(!1),a.parent().empty()})},bindDeleteEvent:function(b){var c=this;c.postToDelete=b,c.deleteDialog?c.deleteDialog.show():(c.changeWorkingState(!0),d.create({type:d.types.DEFAULT,title:c.string.deletecomment,body:c.string.confirmdeletecomment,footer:'<button type="button" data-action="yes" title="'+c.string.deletecomment+'">'+c.string.deletetext+'</button><button type="button" data-action="no" title="'+c.string.cancel+'">'+c.string.cancel+"</button>"}).done(function(b){c.deleteDialog=b,b.getFooter().find('button[data-action="no"]').click(function(a){a.preventDefault(),b.hide()}),b.getFooter().find('button[data-action="yes"]').click(function(d){d.preventDefault(),M.util.js_pending(h.ACTION_DELETE),c.changeWorkingState(!0),c.deleteComment(c.postToDelete.id).then(function(d){if(!d.success)return c.showError(d.message),!0;var f=d.data,g=a(h.SELECTOR.COMMENT_ID+f.id);if(c.postToDelete.root){var i=!c.checkEmptyElement(a(g).find(h.SELECTOR.COMMENT_REPLIES_CONTAINER_TO_ITEM));if(c.postToDelete.expanded&&i)return location.reload(),!0}c.updateCommentCount(c.lastCurrentCount-1,c.lastTotal-1),f.hasOwnProperty("replies")||(f.replies=[]);var j=c.convertForTemplate(f,c.expand);return j.root||(j.expanded=!0),e.render(h.TEMPLATE_COMMENT,j).done(function(b){var d=a(b);if(!j.root){var e=g.parent(),i=e.closest(h.SELECTOR.COMMENT_ITEM).find(h.TOTAL_REPLY),k=i.find(h.SELECTOR.COMMENT_COUNT_NUMBER),l=parseInt(k.text())-1;i.find(h.SELECTOR.COMMENT_COUNT_NUMBER).text(l),i.find(h.SELECTOR.COMMENT_COUNT_TEXT).html(1===l?c.string.reply:c.string.replies)}var m=g.find(h.SELECTOR.COMMENT_REPLIES_CONTAINER).clone(!0);g.replaceWith(d),d.find(h.SELECTOR.COMMENT_REPLIES_CONTAINER).replaceWith(m),c.postToDelete.root?c.bindCommentEvent(f):c.bindReplyEvent(f,d.parent()),c.changeWorkingState(!1),M.util.js_complete(h.ACTION_DELETE)}),b.hide(),!0}).fail(function(a){c.showError(a.message)})}),b.getRoot().on(g.hidden,function(){var b=a(h.SELECTOR.COMMENT_ID+c.postToDelete.id);c.postToDelete.root?b.find(h.SELECTOR.BTN_DELETE).first().focus():b.find(h.SELECTOR.BTN_DELETE_REPLY).first().focus()}),b.getRoot().on(g.shown,function(){c.changeWorkingState(!1)}),b.show(),c.changeWorkingState(!1)}))},deleteComment:function(a){var b=this,d=b.getParamsBeforeCallApi({commentid:a}),e=c.call([{methodname:h.ACTION_DELETE,args:d}]);return e[0]},initAttoEditor:function(a){var b=this,c=a.find(h.SELECTOR.ATTO.CONTENT_WRAP),d=a.find(h.SELECTOR.ATTO.CONTENT),e=a.find("textarea");M.util.js_pending("init_editor"),b.addRemovePlaceHolder(d,c,e),a.find(h.SELECTOR.ATTO.TOOLBAR).fadeIn(),M.util.js_complete("init_editor")},addRemovePlaceHolder:function(a,b,c){var d=this;if(d.canAddPlaceHolder){if(!(h.EMPTY_CONTENT.indexOf(a.html())>-1))return b.attr("data-placeholder",""),c.attr("placeholder",""),void(d.canAddPlaceHolder=!1);var e=d.textareaPlaceholder;b.attr("data-placeholder",e).addClass("force-redraw").removeClass("force-redraw"),c.attr("placeholder",e),setTimeout(function(){d.addRemovePlaceHolder(a,b,c)},250)}},bindEditorEvent:function(b){var c="text_change_"+Date.now(),d=b.find(h.SELECTOR.SUBMIT_BUTTON);d.addClass("disabled");var e=b.find(h.SELECTOR.TEXTAREA),f=e.attr("id")+"editable",g=document.getElementById(f),i=new MutationObserver(function(b){for(var e=0;e<b.length;e++){var g=b[e];"childList"===g.type&&(M.util.js_pending(c),h.EMPTY_CONTENT.indexOf(a("#"+f).html())>-1?(d.addClass("disabled"),d.prop("disabled",!0)):(d.removeClass("disabled"),d.prop("disabled",!1)),M.util.js_complete(c))}});i.observe(g,{attributes:!0,childList:!0,subtree:!0});var j=setInterval(function(){b.find('textarea[id^="id_message"]').trigger("change")},350);setTimeout(function(){clearInterval(j)},5e3)},checkEmptyElement:function(a){return 0===a.length}}},generate:function(a){h.get().init(JSON.parse(a))}};return h});